[unix_http_server]
file=/var/run/supervisor.sock

[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
logfile_maxbytes=10MB
logfile_backups=3
loglevel=info

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:xvnc]
command=/usr/bin/Xvnc %(ENV_DISPLAY)s
    -geometry %(ENV_VNC_RESOLUTION)s
    -depth %(ENV_VNC_COL_DEPTH)s
    -rfbport %(ENV_VNC_PORT)s
    -rfbauth /home/openclaw/.vnc/passwd
    -pn
    -SecurityTypes VncAuth
user=openclaw
autostart=true
autorestart=true
startretries=5
priority=10
stdout_logfile=/var/log/supervisor/xvnc-stdout.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=1
stderr_logfile=/var/log/supervisor/xvnc-stderr.log
stderr_logfile_maxbytes=5MB
stderr_logfile_backups=1

[program:openbox]
command=/usr/bin/openbox-session
environment=DISPLAY="%(ENV_DISPLAY)s",HOME="/home/openclaw"
user=openclaw
autostart=true
autorestart=true
startretries=5
priority=20
stdout_logfile=/var/log/supervisor/openbox-stdout.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=1
stderr_logfile=/var/log/supervisor/openbox-stderr.log
stderr_logfile_maxbytes=5MB
stderr_logfile_backups=1

[program:novnc]
command=/opt/noVNC/utils/novnc_proxy
    --vnc localhost:%(ENV_VNC_PORT)s
    --listen %(ENV_NO_VNC_PORT)s
user=openclaw
autostart=true
autorestart=true
startretries=5
priority=30
stdout_logfile=/var/log/supervisor/novnc-stdout.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=1
stderr_logfile=/var/log/supervisor/novnc-stderr.log
stderr_logfile_maxbytes=5MB
stderr_logfile_backups=1

[program:socat-gateway]
command=socat TCP-LISTEN:%(ENV_GATEWAY_PORT)s,fork,reuseaddr TCP:%(ENV_GATEWAY_HOST)s:%(ENV_GATEWAY_PORT)s
user=openclaw
autostart=true
autorestart=true
startretries=5
priority=35
stdout_logfile=/var/log/supervisor/socat-gateway-stdout.log
stdout_logfile_maxbytes=5MB
stdout_logfile_backups=1
stderr_logfile=/var/log/supervisor/socat-gateway-stderr.log
stderr_logfile_maxbytes=5MB
stderr_logfile_backups=1

[program:openclaw-node]
command=/usr/bin/openclaw node run
    --host localhost
    --port %(ENV_GATEWAY_PORT)s
    --display-name %(ENV_OPENCLAW_NODE_NAME)s
environment=DISPLAY="%(ENV_DISPLAY)s",NODE_ENV="production",HOME="/home/openclaw"
user=openclaw
autostart=true
autorestart=true
startretries=3
startsecs=10
priority=40
stdout_logfile=/var/log/supervisor/openclaw-node-stdout.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=2
stderr_logfile=/var/log/supervisor/openclaw-node-stderr.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=2

[program:log-tail]
command=tail -n 0 -F
    /var/log/supervisor/xvnc-stdout.log
    /var/log/supervisor/xvnc-stderr.log
    /var/log/supervisor/openbox-stdout.log
    /var/log/supervisor/openbox-stderr.log
    /var/log/supervisor/novnc-stdout.log
    /var/log/supervisor/novnc-stderr.log
    /var/log/supervisor/socat-gateway-stdout.log
    /var/log/supervisor/socat-gateway-stderr.log
    /var/log/supervisor/openclaw-node-stdout.log
    /var/log/supervisor/openclaw-node-stderr.log
user=openclaw
autostart=true
autorestart=true
priority=50
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0

[eventlistener:openclaw-node-exit]
command=/usr/bin/python3.9 /usr/local/bin/kill-supervisor.py
events=PROCESS_STATE_FATAL
